<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Schedule - COE Dashboard</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .container {
            max-width: 1400px;
            margin: 20px auto;
            padding: 20px;
        }
        
        .header-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .header-section h1 {
            margin: 0 0 15px 0;
            color: #333;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }
        
        .info-item {
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
        }
        
        .info-item label {
            display: block;
            font-weight: 600;
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .info-item span {
            display: block;
            color: #333;
            font-size: 16px;
        }
        
        .actions-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary {
            background: #4CAF50;
            color: white;
        }
        
        .btn-primary:hover {
            background: #45a049;
        }
        
        .btn-secondary {
            background: #2196F3;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #0b7dda;
        }
        
        .btn-back {
            background: #666;
            color: white;
        }
        
        .btn-back:hover {
            background: #555;
        }
        
        .timetable-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .timetable-section h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        
        .timetable-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .timetable-table th,
        .timetable-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        .timetable-table th {
            background: #4CAF50;
            color: white;
            font-weight: 600;
        }
        
        .timetable-table tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        .timetable-table tr:hover {
            background: #f1f1f1;
        }
        
        .resources-section {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .resource-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .resource-card h3 {
            margin-top: 0;
            color: #4CAF50;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        
        .resource-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .resource-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .resource-list li:last-child {
            border-bottom: none;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-completed {
            background: #4CAF50;
            color: white;
        }
        
        .status-pending {
            background: #ff9800;
            color: white;
        }
        
        .seating-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .seating-section h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        
        .seating-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            text-align: center;
        }
        
        .stat-card .number {
            font-size: 32px;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .stat-card .label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="header-section">
            <h1>Exam Schedule Details</h1>
            <div class="info-grid">
                <div class="info-item">
                    <label>Academic Year</label>
                    <span><%= schedule.academicYear %></span>
                </div>
                <div class="info-item">
                    <label>Exam Type</label>
                    <span><%= schedule.examType %></span>
                </div>
                <div class="info-item">
                    <label>Year</label>
                    <span>Year <%= schedule.year %></span>
                </div>
                <% if (schedule.session) { %>
                <div class="info-item">
                    <label>Session</label>
                    <span><%= schedule.session %></span>
                </div>
                <% } %>
                <div class="info-item">
                    <label>Start Date</label>
                    <span><%= new Date(schedule.startDate).toLocaleDateString() %></span>
                </div>
                <div class="info-item">
                    <label>End Date</label>
                    <span><%= new Date(schedule.endDate).toLocaleDateString() %></span>
                </div>
                <div class="info-item">
                    <label>Status</label>
                    <span class="status-badge status-completed">Completed</span>
                </div>
            </div>
        </div>
        
        <!-- Actions Section -->
        <div class="actions-section">
            <h3>Actions</h3>
            <div class="btn-group">
                <a href="/coe/dashboard" class="btn btn-back">‚Üê Back to Dashboard</a>
                <% if (schedule.timetablePdfPath) { %>
                    <a href="/api/coe/download-timetable/<%= schedule._id %>" 
                       class="btn btn-primary" target="_blank">
                        üìÑ Download Timetable PDF
                    </a>
                <% } %>
                <% if (schedule.seatingPdfPaths && schedule.seatingPdfPaths.studentPdf) { %>
                    <a href="/api/coe/download-seating-student/<%= schedule._id %>" 
                       class="btn btn-secondary" target="_blank">
                        üìã Download Student Seating PDF
                    </a>
                <% } %>
                <% if (schedule.seatingPdfPaths && schedule.seatingPdfPaths.facultyPdf) { %>
                    <a href="/api/coe/download-seating-faculty/<%= schedule._id %>" 
                       class="btn btn-secondary" target="_blank">
                        üë• Download Faculty Duty Roster PDF
                    </a>
                <% } %>
                <% if (schedule.examType === 'SEM' && !schedule.hallTicketsAuthorized) { %>
                    <button class="btn btn-primary" onclick="authorizeHallTickets()">
                        ‚úÖ Authorize Hall Tickets
                    </button>
                <% } %>
                <% if (schedule.hallTicketsAuthorized) { %>
                    <span class="status-badge status-completed">Hall Tickets Authorized</span>
                <% } %>
            </div>
        </div>
        
        <!-- Timetable Section -->
        <div class="timetable-section">
            <h2>Exam Timetable</h2>
            <% if (timetable && timetable.length > 0) { %>
                <table class="timetable-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Subject</th>
                            <th>Time</th>
                            <th>Halls</th>
                            <th>Invigilators</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% timetable.forEach(entry => { %>
                        <tr>
                            <td><%= new Date(entry.date).toLocaleDateString() %></td>
                            <td>
                                <strong><%= entry.subject.name %></strong><br>
                                <small><%= entry.subject.code %></small>
                            </td>
                            <td><%= entry.timeStart %> - <%= entry.timeEnd %></td>
                            <td>
                                <% entry.halls.forEach(hall => { %>
                                    <%= hall.hallNumber %><br>
                                <% }) %>
                            </td>
                            <td>
                                <% entry.invigilators.forEach(faculty => { %>
                                    <%= faculty.name %><br>
                                <% }) %>
                            </td>
                        </tr>
                        <% }) %>
                    </tbody>
                </table>
            <% } else { %>
                <p>No timetable entries found.</p>
            <% } %>
        </div>
        
        <!-- Resources Section -->
        <div class="resources-section">
            <div class="resource-card">
                <h3>Selected Faculty (<%= schedule.facultyIncharge ? schedule.facultyIncharge.length : 0 %>)</h3>
                <ul class="resource-list">
                    <% if (schedule.facultyIncharge && schedule.facultyIncharge.length > 0) { %>
                        <% schedule.facultyIncharge.forEach(faculty => { %>
                        <li><%= faculty.name %> (<%= faculty.email %>)</li>
                        <% }) %>
                    <% } else { %>
                        <li>No faculty assigned</li>
                    <% } %>
                </ul>
            </div>
            
            <div class="resource-card">
                <h3>Selected Halls (<%= schedule.halls ? schedule.halls.length : 0 %>)</h3>
                <ul class="resource-list">
                    <% if (schedule.halls && schedule.halls.length > 0) { %>
                        <% schedule.halls.forEach(hall => { %>
                        <li><%= hall.hallNumber %> - <%= hall.building %> (Capacity: <%= hall.capacity %>)</li>
                        <% }) %>
                    <% } else { %>
                        <li>No halls assigned</li>
                    <% } %>
                </ul>
            </div>
        </div>
        
        <!-- Seating Stats Section -->
        <% if (schedule.seatingStats) { %>
        <div class="seating-section">
            <h2>Seating Arrangement Statistics</h2>
            <div class="seating-stats">
                <div class="stat-card">
                    <div class="number"><%= schedule.seatingStats.totalStudents || 0 %></div>
                    <div class="label">Total Students</div>
                </div>
                <div class="stat-card">
                    <div class="number"><%= schedule.seatingStats.hallsUsed || 0 %></div>
                    <div class="label">Halls Used</div>
                </div>
                <div class="stat-card">
                    <div class="number"><%= schedule.seatingStats.allocationsCount || 0 %></div>
                    <div class="label">Seat Allocations</div>
                </div>
            </div>
        </div>
        <% } %>
    </div>
    
    <script>
        async function authorizeHallTickets() {
            if (!confirm('Are you sure you want to authorize hall ticket generation for all students?')) {
                return;
            }
            
            try {
                const response = await fetch('/api/coe/authorize-hall-tickets/<%= schedule._id %>', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    alert('Hall tickets authorized successfully!');
                    window.location.reload();
                } else {
                    alert('Error: ' + (result.message || 'Failed to authorize hall tickets'));
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
    </script>
</body>
</html>
